<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Calculadora Avan√ßa Escola</title>
  <style>
    /* ===== Reset / alinhamento ===== */
    *, *::before, *::after { box-sizing: border-box; }

    /* ===== Paleta neutra e moderna ===== */
    :root{
      --bg: #f7f8fb;
      --card: #ffffff;
      --card-2: #eef1f8;
      --text: #0f172a;
      --muted: #4b5563;
      --border: #e2e8f0;

      --input-bg: #f8fafc;
      --input-border: #d7deea;

      --accent: #2563eb;
      --accent-hover: #1d4ed8;
      --accent-soft: #e4ecff;

      --shadow: 0 20px 60px rgba(15, 23, 42, .08);
      --radius: 14px;
    }

    /* ===== Tema ESCURO ===== */
    body.dark{
      --bg: #0b1224;
      --card: #0f172a;
      --card-2: #0b1220;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --border: #1f2937;

      --input-bg: #0e162c;
      --input-border: #243045;

      --accent: #22c1b0;
      --accent-hover: #1aa596;
      --accent-soft: #123447;

      --shadow: 0 20px 70px rgba(0,0,0,.45);
      --radius: 16px;
    }

    body{
      margin:0;
      background: radial-gradient(circle at 10% 20%, #e8edff 0, transparent 25%),
                  radial-gradient(circle at 90% 10%, #d9f2ff 0, transparent 24%),
                  var(--bg);
      color: var(--text);
      font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      min-height:100vh;
      padding:48px 16px 64px;
      transition: background .35s ease, color .25s ease;
    }

    body.dark{
      background: radial-gradient(1200px circle at 12% -6%, rgba(37,99,235,.08) 0%, transparent 50%),
                  radial-gradient(1100px circle at 86% 12%, rgba(34,193,176,.12) 0%, transparent 48%),
                  var(--bg);
    }

    .card{
      width:520px;
      max-width:100%;
      background: var(--card);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:28px 28px 24px;
      transition: background .25s ease, border-color .25s ease, box-shadow .25s ease, transform .25s ease;
    }
    .card:hover{ transform: translateY(-2px); }

    /* Header com toggle */
    .header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      margin-bottom:14px;
    }
    .title-wrap{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .eyebrow{
      text-transform:uppercase;
      font-size:11px;
      letter-spacing:0.12em;
      color: var(--muted);
      margin:0;
    }
    .header h2{
      margin:0;
      font-size:22px;
      font-weight:700;
      letter-spacing:.1px;
    }
    .subtitle{
      margin:4px 0 0;
      color: var(--muted);
      font-size:13px;
      line-height:1.5;
    }

    .theme-toggle{
      display:flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--border);
      background: color-mix(in srgb, var(--accent) 7%, var(--card));
      color: var(--text);
      cursor:pointer;
      font-size:12px;
      font-weight:700;
      transition: background .2s ease, border-color .2s ease, transform .08s ease, box-shadow .2s ease;
      user-select:none;
      box-shadow: 0 10px 24px color-mix(in srgb, var(--accent) 12%, transparent);
    }
    .theme-toggle:hover{
      background: color-mix(in srgb, var(--accent) 14%, var(--card));
      border-color: color-mix(in srgb, var(--accent) 40%, var(--border));
      box-shadow: 0 12px 28px color-mix(in srgb, var(--accent) 16%, transparent);
    }
    .theme-toggle:active{ transform: translateY(1px); }

    .section-title{
      margin:18px 0 10px;
      padding-top:14px;
      border-top:1px solid var(--border);
      font-size:12px;
      font-weight:700;
      color: var(--muted);
      text-transform:uppercase;
      letter-spacing:.6px;
    }

    .section-grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap:12px 16px;
    }

    .input-group{
      margin:0;
      padding:12px;
      border:1px solid var(--border);
      border-radius:10px;
      background: var(--card-2);
      transition: border-color .18s ease, background .18s ease, transform .18s ease;
    }
    .input-group:focus-within{
      border-color: color-mix(in srgb, var(--accent) 60%, var(--border));
      background: color-mix(in srgb, var(--accent-soft) 55%, var(--card));
      transform: translateY(-1px);
      box-shadow: 0 6px 16px color-mix(in srgb, var(--accent) 12%, transparent);
    }

    label{
      display:block;
      margin-bottom:8px;
      font-size:13px;
      color: var(--muted);
      font-weight:600;
    }

    input{
      width:100%;
      padding:11px 12px;
      border-radius:9px;
      border:1px solid var(--input-border);
      background: var(--input-bg);
      color: var(--text);
      outline:none;
      font-size:14px;
      transition:border-color .15s ease, box-shadow .15s ease, background .15s ease, transform .08s ease;
    }

    input:focus{
      background: #fff;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 18%, transparent);
      transform: translateY(-1px);
    }
    body.dark input:focus{
      background: var(--input-bg);
    }
    input:focus-visible{ outline: 2px solid color-mix(in srgb, var(--accent) 60%, transparent); outline-offset: 2px; }

    /* ===== Bot√µes ===== */
    .actions{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:10px;
    }

    button{ font-family: inherit; }

    button.calc{
      width:100%;
      margin-top:0;
      padding:14px;
      border:none;
      border-radius:10px;
      background: linear-gradient(135deg, var(--accent), color-mix(in srgb, var(--accent-hover) 80%, var(--accent)));
      color:#fff;
      font-weight:700;
      cursor:pointer;
      transition: background .15s ease, transform .08s ease, box-shadow .2s ease;
      box-shadow: 0 10px 22px color-mix(in srgb, var(--accent) 32%, transparent);
      letter-spacing:.2px;
    }
    button.calc:hover{ background: linear-gradient(135deg, var(--accent-hover), var(--accent)); }
    button.calc:active{ transform: translateY(1px); }

    button.secondary{
      width:100%;
      padding:12px;
      border-radius:10px;
      border:1px solid var(--border);
      background: var(--card);
      color: var(--text);
      font-weight:600;
      cursor:pointer;
      transition: background .15s ease, transform .08s ease, border-color .15s ease, box-shadow .15s ease;
    }
    button.secondary:hover{
      background: color-mix(in srgb, var(--accent) 7%, var(--card));
      border-color: color-mix(in srgb, var(--accent) 35%, var(--border));
      box-shadow: 0 8px 18px color-mix(in srgb, var(--accent) 16%, transparent);
    }
    button.secondary:active{ transform: translateY(1px); }

    #resultados{
      margin-top:18px;
      padding:16px;
      border-radius:12px;
      background: var(--card-2);
      border:1px solid color-mix(in srgb, var(--border) 70%, transparent);
      font-size:14px;
      line-height:1.6;

      opacity:0;
      transform:translateY(10px);
      transition:all .35s ease, background .25s ease, border-color .25s ease;
      display:none; /* come√ßa escondido */
    }
    #resultados.visible{
      opacity:1;
      transform:translateY(0);
      display:block;
    }

    h3{ margin:0 0 8px; font-size:16px; }
    b{ color: var(--text); }
    .muted{ color: var(--muted); font-size:12px; }
  </style>
</head>
<body>

  <div class="card">
    <div class="header">
      <div class="title-wrap">
        <p class="eyebrow">Avan√ßa Escola</p>
        <h2>Calculadora de Repasse</h2>
        <p class="subtitle">Preencha os campos para estimar rapidamente o valor de repasse por etapa e por parcela.</p>
      </div>
      <button id="toggleTema" class="theme-toggle" type="button" onclick="toggleTema()" aria-label="Alternar tema">
        üåô Escuro
      </button>
    </div>

    <div class="section-title">Alunos por etapa e jornada</div>
    <div class="section-grid" aria-label="Quantidade de alunos">
      <div class="input-group">
        <label for="creche_p">Creche ‚Äì Parcial</label>
        <input id="creche_p" type="number" min="0" value="0">
      </div>
      <div class="input-group">
        <label for="creche_i">Creche ‚Äì Integral</label>
        <input id="creche_i" type="number" min="0" value="0">
      </div>
      <div class="input-group">
        <label for="pre_p">Pr√©-escola ‚Äì Parcial</label>
        <input id="pre_p" type="number" min="0" value="0">
      </div>
      <div class="input-group">
        <label for="pre_i">Pr√©-escola ‚Äì Integral</label>
        <input id="pre_i" type="number" min="0" value="0">
      </div>
      <div class="input-group">
        <label for="fund_p">Fundamental ‚Äì Parcial</label>
        <input id="fund_p" type="number" min="0" value="0">
      </div>
      <div class="input-group">
        <label for="fund_i">Fundamental ‚Äì Integral</label>
        <input id="fund_i" type="number" min="0" value="0">
      </div>
      <div class="input-group">
        <label for="eja">EJA (tratado como Parcial)</label>
        <input id="eja" type="number" min="0" value="0">
      </div>
      <div class="input-group">
        <label for="tecnico">T√©cnico (tratado como Parcial)</label>
        <input id="tecnico" type="number" min="0" value="0">
      </div>
    </div>

    <div class="section-title">Destina√ß√£o do recurso</div>
    <div class="section-grid" aria-label="Destina√ß√£o do recurso">
      <div class="input-group">
        <label for="custeio">Custeio (%)</label>
        <input id="custeio" type="number" min="0" max="100" value="80">
      </div>
      <div class="input-group">
        <label for="capital">Capital (%)</label>
        <input id="capital" type="number" min="0" max="100" value="20">
      </div>
    </div>

    <div class="section-title">Par√¢metros</div>
    <div class="section-grid" aria-label="Par√¢metros">
      <div class="input-group">
        <label for="valor_parcial">Valor por aluno Parcial (R$)</label>
        <input id="valor_parcial" type="number" step="0.01" min="0" value="125.03">
        <div class="muted">Padr√£o: R$ 125,03</div>
      </div>

      <div class="input-group">
        <label for="valor_integral">Valor por aluno Integral (R$)</label>
        <input id="valor_integral" type="number" step="0.01" min="0" value="250.06" readonly>
        <div class="muted">Integral = Parcial x 2</div>
      </div>
    </div>

    <div class="actions">
      <button class="calc" onclick="calcular()">Calcular</button>
      <button class="secondary" type="button" onclick="limparCampos()">Limpar</button>
      <button class="secondary" type="button" onclick="imprimir()">Imprimir</button>
    </div>

    <div id="resultados" aria-live="polite"></div>
  </div>

  <script>
    /* ======= Tema: carregar prefer√™ncia ======= */
    (function initTema(){
      const salvo = localStorage.getItem("tema");
      const preferDark = salvo === "dark";
      if (preferDark) document.body.classList.add("dark");
      atualizarLabelTema();
    })();

    function toggleTema(){
      document.body.classList.toggle("dark");
      localStorage.setItem("tema", document.body.classList.contains("dark") ? "dark" : "light");
      atualizarLabelTema();
    }

    function atualizarLabelTema(){
      const btn = document.getElementById("toggleTema");
      const darkAtivo = document.body.classList.contains("dark");
      btn.textContent = darkAtivo ? "‚òÄÔ∏è Claro" : "üåô Escuro";
    }

    /* ======= Formata√ß√£o monet√°ria pt-BR ======= */
    const formatBRL = new Intl.NumberFormat('pt-BR', {
      style: 'currency',
      currency: 'BRL',
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    });
    function moeda(v){ return formatBRL.format(v); }

    /* ======= Atualizar valor integral (parcial x 2) ======= */
    function atualizarValorIntegral() {
      const parcialInput = document.getElementById("valor_parcial");
      const integralInput = document.getElementById("valor_integral");
      const valor_parcial = Number(parcialInput.value) || 0;
      integralInput.value = (valor_parcial * 2).toFixed(2);
    }

    // Atualiza ao digitar no parcial
    document.getElementById("valor_parcial").addEventListener("input", atualizarValorIntegral);
    // Garante coer√™ncia inicial
    atualizarValorIntegral();

    /* ======= Percentuais custeio/capital sempre somando 100 ======= */
    const custeioInput = document.getElementById("custeio");
    const capitalInput = document.getElementById("capital");

    function normalizarPercentual(input, fallback){
      let valor = Number(input.value);
      if (!Number.isFinite(valor)) valor = fallback;
      valor = Math.min(100, Math.max(0, valor));
      input.value = valor.toFixed(2);
      return valor;
    }

    function sincronizarCapital(){
      const custeio = normalizarPercentual(custeioInput, 80);
      capitalInput.value = (100 - custeio).toFixed(2);
    }

    function sincronizarCusteio(){
      const capital = normalizarPercentual(capitalInput, 20);
      custeioInput.value = (100 - capital).toFixed(2);
    }

    custeioInput.addEventListener("input", sincronizarCapital);
    capitalInput.addEventListener("input", sincronizarCusteio);
    sincronizarCapital();

    /* ======= Parcelamento sem estourar total ======= */
    function splitParcela(valorTotal) {
      const base = valorTotal / 2;
      const parcela1 = Math.round(base * 100) / 100;
      const parcela2 = Math.round((valorTotal - parcela1) * 100) / 100;
      return [parcela1, parcela2];
    }

    function obterNumero(id, nome){
      const valor = Number(document.getElementById(id).value);
      if (!Number.isFinite(valor)) {
        throw new Error(`O campo "${nome}" n√£o possui um n√∫mero v√°lido.`);
      }
      return valor;
    }

    function calcular() {
      let creche_p, creche_i, pre_p, pre_i, fund_p, fund_i, eja, tecnico;
      let perc_custeio, perc_capital, valor_parcial;

      try {
        creche_p = obterNumero("creche_p", "Creche ‚Äì Parcial");
        creche_i = obterNumero("creche_i", "Creche ‚Äì Integral");
        pre_p    = obterNumero("pre_p", "Pr√©-escola ‚Äì Parcial");
        pre_i    = obterNumero("pre_i", "Pr√©-escola ‚Äì Integral");
        fund_p   = obterNumero("fund_p", "Fundamental ‚Äì Parcial");
        fund_i   = obterNumero("fund_i", "Fundamental ‚Äì Integral");
        eja      = obterNumero("eja", "EJA");
        tecnico  = obterNumero("tecnico", "T√©cnico");

        perc_custeio = obterNumero("custeio", "Custeio");
        perc_capital = obterNumero("capital", "Capital");
        valor_parcial  = obterNumero("valor_parcial", "Valor Parcial por aluno");
      } catch (err){
        mostrarResultados(`<b>Erro:</b> ${err.message}`);
        return;
      }

      let valor_integral = valor_parcial * 2; // sempre integral = parcial x 2

      const inputs = [creche_p, creche_i, pre_p, pre_i, fund_p, fund_i, eja, tecnico];

      if (inputs.some(v => v < 0)) {
        mostrarResultados("<b>Erro:</b> Nenhum campo de alunos pode ser negativo.");
        return;
      }
      if (valor_parcial < 0 || valor_integral < 0) {
        mostrarResultados("<b>Erro:</b> Valores per capita n√£o podem ser negativos.");
        return;
      }
      if (perc_custeio < 0 || perc_capital < 0) {
        mostrarResultados("<b>Erro:</b> Percentuais n√£o podem ser negativos.");
        return;
      }
      if (Math.round((perc_custeio + perc_capital) * 100) / 100 !== 100) {
        mostrarResultados("<b>Erro:</b> Custeio + Capital deve somar 100%.");
        return;
      }

      let total_parcial  = creche_p + pre_p + fund_p + eja + tecnico;
      let total_integral = creche_i + pre_i + fund_i;
      let total_alunos   = total_parcial + total_integral;

      if (total_alunos === 0) {
        mostrarResultados("<b>Erro:</b> O total de alunos n√£o pode ser zero.");
        return;
      }

      let vl_creche = (creche_p * valor_parcial) + (creche_i * valor_integral);
      let vl_pre    = (pre_p    * valor_parcial) + (pre_i    * valor_integral);
      let vl_fund   = (fund_p   * valor_parcial) + (fund_i   * valor_integral);
      let vl_eja    = (eja      * valor_parcial);
      let vl_tec    = (tecnico  * valor_parcial);

      let [creche_p1, creche_p2] = splitParcela(vl_creche);
      let [pre_p1, pre_p2]       = splitParcela(vl_pre);
      let [fund_p1, fund_p2]     = splitParcela(vl_fund);
      let [eja_p1, eja_p2]       = splitParcela(vl_eja);
      let [tec_p1, tec_p2]       = splitParcela(vl_tec);

      let valor_total_escola = vl_creche + vl_pre + vl_fund + vl_eja + vl_tec;

      let custeio_total = valor_total_escola * (perc_custeio/100);
      let capital_total = valor_total_escola * (perc_capital/100);

      let [parcela1, parcela2] = splitParcela(valor_total_escola);

      let html = `
        <h3>Resultado</h3>

        <b>Alunos</b><br>
        Total parcial: ${total_parcial}<br>
        Total integral: ${total_integral}<br>
        <b>Total de alunos:</b> ${total_alunos}<br><br>

        <b>Valores devidos por etapa</b><br>
        Creche: ${moeda(vl_creche)}
          <span class="muted">(P1: ${moeda(creche_p1)} | P2: ${moeda(creche_p2)})</span><br>
        Pr√©-escola: ${moeda(vl_pre)}
          <span class="muted">(P1: ${moeda(pre_p1)} | P2: ${moeda(pre_p2)})</span><br>
        Fundamental: ${moeda(vl_fund)}
          <span class="muted">(P1: ${moeda(fund_p1)} | P2: ${moeda(fund_p2)})</span><br>
        EJA: ${moeda(vl_eja)}
          <span class="muted">(P1: ${moeda(eja_p1)} | P2: ${moeda(eja_p2)})</span><br>
        T√©cnico: ${moeda(vl_tec)}
          <span class="muted">(P1: ${moeda(tec_p1)} | P2: ${moeda(tec_p2)})</span><br><br>

        <b>Valor total devido:</b> ${moeda(valor_total_escola)}<br><br>

        <b>Destina√ß√£o</b><br>
        Custeio (${perc_custeio}%): ${moeda(custeio_total)}<br>
        Capital (${perc_capital}%): ${moeda(capital_total)}<br><br>

        <b>Parcelamento</b><br>
        Parcela 1: ${moeda(parcela1)}<br>
        Parcela 2: ${moeda(parcela2)}<br>
        <span class="muted">(Parcela 1 + Parcela 2 = ${moeda(parcela1+parcela2)})</span>
      `;

      mostrarResultados(html);
    }

    function mostrarResultados(html) {
      let div = document.getElementById("resultados");
      if (!html) {
        div.innerHTML = "";
        div.classList.remove("visible");
        div.style.display = "none";
        return;
      }
      div.innerHTML = html;
      div.style.display = "block";
      div.classList.remove("visible");
      setTimeout(() => div.classList.add("visible"), 50);
    }

    function limparCampos(){
      const ids = ["creche_p","creche_i","pre_p","pre_i","fund_p","fund_i","eja","tecnico"];
      ids.forEach(id => document.getElementById(id).value = 0);

      document.getElementById("custeio").value = 80;
      document.getElementById("capital").value = 20;
      document.getElementById("valor_parcial").value = 125.03;
      sincronizarCapital();
      atualizarValorIntegral(); // integral volta a ser 2x parcial padr√£o

      mostrarResultados("");
    }

    function imprimir(){
      window.print();
    }
  </script>

</body>
</html>
