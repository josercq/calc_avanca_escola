<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Calculadora Avança Escola</title>
<style>
    body {
        background: #000;
        color: #fff;
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        height: 100vh;
        padding-top: 40px;
    }

    .card {
        background: #111;
        padding: 25px;
        width: 420px;
        border-radius: 10px;
        box-shadow: 0 0 10px #fff3;
    }

    .card h2 {
        margin-top: 0;
        text-align: center;
    }

    .section-title{
        margin: 16px 0 6px;
        font-weight: bold;
        font-size: 14px;
        color: #ddd;
        border-top: 1px solid #222;
        padding-top: 10px;
    }

    .input-group { margin-bottom: 12px; }

    label {
        display: block;
        margin-bottom: 4px;
        font-size: 13px;
        color: #ccc;
    }

    input {
        width: 100%;
        padding: 8px;
        border: 1px solid #444;
        border-radius: 5px;
        background: #222;
        color: #fff;
    }

    button {
        width: 100%;
        padding: 12px;
        margin-top: 10px;
        background: #fff;
        color: #000;
        border: none;
        cursor: pointer;
        font-weight: bold;
        border-radius: 5px;
        transition: 0.2s;
    }

    button:hover { background: #ccc; }

    #resultados {
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.5s ease;
        margin-top: 25px;
        padding: 20px;
        border: 1px solid #fff2;
        border-radius: 8px;
        background: #111;
        font-size: 14px;
        line-height: 1.5;
    }

    #resultados.visible {
        opacity: 1;
        transform: translateY(0);
    }

    .muted { color:#aaa; font-size:12px; }
</style>
</head>
<body>

<div class="card">
    <h2>Calculadora de Repasse</h2>

    <div class="section-title">Alunos por etapa e jornada</div>

    <div class="input-group">
        <label>Creche – Parcial</label>
        <input id="creche_p" type="number" min="0" value="0">
    </div>
    <div class="input-group">
        <label>Creche – Integral</label>
        <input id="creche_i" type="number" min="0" value="0">
    </div>

    <div class="input-group">
        <label>Pré-escola – Parcial</label>
        <input id="pre_p" type="number" min="0" value="0">
    </div>
    <div class="input-group">
        <label>Pré-escola – Integral</label>
        <input id="pre_i" type="number" min="0" value="0">
    </div>

    <div class="input-group">
        <label>Fundamental – Parcial</label>
        <input id="fund_p" type="number" min="0" value="0">
    </div>
    <div class="input-group">
        <label>Fundamental – Integral</label>
        <input id="fund_i" type="number" min="0" value="0">
    </div>

    <div class="input-group">
        <label>EJA (tratado como Parcial)</label>
        <input id="eja" type="number" min="0" value="0">
    </div>

    <div class="input-group">
        <label>Técnico (tratado como Parcial)</label>
        <input id="tecnico" type="number" min="0" value="0">
    </div>

    <div class="section-title">Destinação do recurso</div>

    <div class="input-group">
        <label>Custeio (%)</label>
        <input id="custeio" type="number" min="0" max="100" value="80">
    </div>

    <div class="input-group">
        <label>Capital (%)</label>
        <input id="capital" type="number" min="0" max="100" value="20">
    </div>

    <div class="section-title">Parâmetros</div>

    <div class="input-group">
        <label>Valor por aluno Parcial (R$)</label>
        <input id="valor_parcial" type="number" step="0.01" min="0" value="125.03">
        <div class="muted">Padrão: R$ 125,03</div>
    </div>

    <div class="input-group">
        <label>Valor por aluno Integral (R$)</label>
        <input id="valor_integral" type="number" step="0.01" min="0" value="250.06">
        <div class="muted">Padrão: R$ 250,06</div>
    </div>

    <button onclick="calcular()">Calcular</button>

    <div id="resultados"></div>
</div>

<script>
/* ======= Formatação monetária pt-BR ======= */
const formatBRL = new Intl.NumberFormat('pt-BR', {
    style: 'currency',
    currency: 'BRL',
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
});
function moeda(v){ return formatBRL.format(v); }

/* ======= Parcelamento sem estourar total ======= */
function splitParcela(valorTotal) {
    const base = valorTotal / 2;
    const parcela1 = Math.round(base * 100) / 100;
    const parcela2 = Math.round((valorTotal - parcela1) * 100) / 100;
    return [parcela1, parcela2];
}

function calcular() {
    // Alunos
    let creche_p = Number(document.getElementById("creche_p").value);
    let creche_i = Number(document.getElementById("creche_i").value);
    let pre_p    = Number(document.getElementById("pre_p").value);
    let pre_i    = Number(document.getElementById("pre_i").value);
    let fund_p   = Number(document.getElementById("fund_p").value);
    let fund_i   = Number(document.getElementById("fund_i").value);
    let eja      = Number(document.getElementById("eja").value);
    let tecnico  = Number(document.getElementById("tecnico").value);

    // Percentuais
    let perc_custeio = Number(document.getElementById("custeio").value);
    let perc_capital = Number(document.getElementById("capital").value);

    // Parâmetros
    let valor_parcial  = Number(document.getElementById("valor_parcial").value);
    let valor_integral = Number(document.getElementById("valor_integral").value);

    // Validações
    const inputs = [creche_p, creche_i, pre_p, pre_i, fund_p, fund_i, eja, tecnico];
    if (inputs.some(v => v < 0)) {
        mostrarResultados("<b>Erro:</b> Nenhum campo de alunos pode ser negativo.");
        return;
    }
    if (valor_parcial < 0 || valor_integral < 0) {
        mostrarResultados("<b>Erro:</b> Valores per capita não podem ser negativos.");
        return;
    }
    if (perc_custeio < 0 || perc_capital < 0) {
        mostrarResultados("<b>Erro:</b> Percentuais não podem ser negativos.");
        return;
    }
    if (Math.round((perc_custeio + perc_capital) * 100) / 100 !== 100) {
        mostrarResultados("<b>Erro:</b> Custeio + Capital deve somar 100%.");
        return;
    }

    // Totais de alunos
    let total_parcial  = creche_p + pre_p + fund_p + eja + tecnico;
    let total_integral = creche_i + pre_i + fund_i;
    let total_alunos   = total_parcial + total_integral;

    if (total_alunos === 0) {
        mostrarResultados("<b>Erro:</b> O total de alunos não pode ser zero.");
        return;
    }

    // Valores devidos por etapa
    let vl_creche = (creche_p * valor_parcial) + (creche_i * valor_integral);
    let vl_pre    = (pre_p    * valor_parcial) + (pre_i    * valor_integral);
    let vl_fund   = (fund_p   * valor_parcial) + (fund_i   * valor_integral);
    let vl_eja    = (eja      * valor_parcial); // parcial
    let vl_tec    = (tecnico  * valor_parcial); // parcial

    // Parcelas por etapa (com ajuste de centavos)
    let [creche_p1, creche_p2] = splitParcela(vl_creche);
    let [pre_p1, pre_p2]       = splitParcela(vl_pre);
    let [fund_p1, fund_p2]     = splitParcela(vl_fund);
    let [eja_p1, eja_p2]       = splitParcela(vl_eja);
    let [tec_p1, tec_p2]       = splitParcela(vl_tec);

    // Total devido
    let valor_total_escola = vl_creche + vl_pre + vl_fund + vl_eja + vl_tec;

    // Custeio e capital
    let custeio_total = valor_total_escola * (perc_custeio/100);
    let capital_total = valor_total_escola * (perc_capital/100);

    // Parcelas totais (com ajuste de centavos)
    let [parcela1, parcela2] = splitParcela(valor_total_escola);

    let html = `
        <h3>Resultado</h3>

        <b>Alunos</b><br>
        Total parcial: ${total_parcial}<br>
        Total integral: ${total_integral}<br>
        <b>Total de alunos:</b> ${total_alunos}<br><br>

        <b>Valores devidos por etapa</b><br>
        Creche: ${moeda(vl_creche)}
          <span class="muted">(P1: ${moeda(creche_p1)} | P2: ${moeda(creche_p2)})</span><br>
        Pré-escola: ${moeda(vl_pre)}
          <span class="muted">(P1: ${moeda(pre_p1)} | P2: ${moeda(pre_p2)})</span><br>
        Fundamental: ${moeda(vl_fund)}
          <span class="muted">(P1: ${moeda(fund_p1)} | P2: ${moeda(fund_p2)})</span><br>
        EJA: ${moeda(vl_eja)}
          <span class="muted">(P1: ${moeda(eja_p1)} | P2: ${moeda(eja_p2)})</span><br>
        Técnico: ${moeda(vl_tec)}
          <span class="muted">(P1: ${moeda(tec_p1)} | P2: ${moeda(tec_p2)})</span><br><br>

        <b>Valor total devido:</b> ${moeda(valor_total_escola)}<br><br>

        <b>Destinação</b><br>
        Custeio (${perc_custeio}%): ${moeda(custeio_total)}<br>
        Capital (${perc_capital}%): ${moeda(capital_total)}<br><br>

        <b>Parcelamento</b><br>
        Parcela 1: ${moeda(parcela1)}<br>
        Parcela 2: ${moeda(parcela2)}<br>
        <span class="muted">(Parcela 1 + Parcela 2 = ${moeda(parcela1+parcela2)})</span>
    `;

    mostrarResultados(html);
}

function mostrarResultados(html) {
    let div = document.getElementById("resultados");
    div.innerHTML = html;

    div.classList.remove("visible");
    setTimeout(() => {
        div.classList.add("visible");
    }, 50);
}
</script>

</body>
</html>
